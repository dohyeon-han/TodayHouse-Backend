## JWT
- 프로젝트에서 처음으로 jwt를 사용하였다.

### JWT란?
- jwt는 JSON Web Tokens의 약자로 인증을 하기 위한 토큰이다.
- Header, Payload, Signature로 이뤄져있다.

### 사용하는 이유
- 로그인 상태를 유지하기 위해서 기존에는 사용자의 상태를 주로 세션에 저장하였다. 하지만 사용자의 수가 늘어나면 세션에도 부하가 발생하여 이용에 부담이 생긴다.
- 세션에 부하를 줄이기 위해 쿠키를 사용할 수도 있지만 쿠키의 사용자의 정보를 그대로 저장하는 것은 굉장히 위험하다.
- 그래서 정보를 암호화하여 인증하는 도구가 JWT이다.
- JWT를 사용하면 서버에서 사용자를 조회할 필요없이 유효한 토큰인지만 확인하면 되기 때문에 stateless하다.

### 취약점
- 하지만 JWT도 쿠키를 사용하여 클라이언트에 정보를 저장하기 때문에 약점이 존재한다.
- JWT를 탈취 당하면 JWT는 서버에 저장하지 않기 때문에 조치를 취하기 어렵다. 이를 막기 위해 서버에 저장하면 JWT의 큰 장점인 stateless가 사라진다.

### 대책
- JWT가 탈취되는 경우를 위해 보통 access token, refresh token 두가지를 사용한다.
- access token의 만료 기한은 짧게, refresh token의 만료 기한은 길게 잡아 access token이 만료되면 refresh toke을 확인해 만료된 토큰을 다시 발급한다. refresh token은 access token보다 더 안전한 곳에 저장해야한다. 지금 진행하는 프로젝트는 JPA에 조금 더 초점을 맞춰서 진행했기 때문에 refresh token은 따로 구현하지 않았다.

### 저장 위치?
- 가장 궁금했던 부분이다. 인터넷에도 제각기 말이 달랐기 때문에 정확한 결론을 내리긴 어려웠다. 저장 위치는 대체로 cookie, local storage, DB 세 군데로 나뉘는 것을 알 수 있었다.
- refresh token의 경우는 절대 탈취되면 안되기 때문에 stateless를 조금 포기하더라도 DB에 저장하는 것이 가장 좋다고 생각한다. 찾아보다가 redis라는 인메모리 DB가 존재하는 것도 알게 되었는데 토큰을 단순히 저장하고 조회하는 기능이 필요하기 때문에 이 방법을 사용하는 것이 좋아보인다.
- access token은 클라이언트단에 저장을 해야하기때문에 cookie 혹은 local storage에 저장해야 한다. 하지만 대표적인 취약점 존재하는데 바로 XSS와 CSRF이다.
#### XSS(Cross Site Scripting)
- 웹페이지에 악의적인 스크립트를 넣어놓고 document.cookie와 같은 코드를 통해 사용자의 정보를 알아내는 공격이다.
- local storage의 경우 이 공격에 취약하다.
- cookie의 경우 HttpOnly 옵션을 통해 스크립트 조작을 막을 수 있다.
#### CRSF(Cross-site request forgery)
- cookie가 request에 자동으로 실려 전송되는 것을 활용한 공격이다.
- 만약 A 사이트의 로그인 정보를 쿠키로 가진 채 해커가 만든 B 사이트로 이동을 했다고 가정하자. 이때 B 사이트의 form 태그 등을 클릭하면, A 사이트로 쿠키와 함께 request가 전송되어 사용자의 정보를 생성, 변경, 삭제할 수 있다.
- local storage는 헤더에 자동으로 실리지 않아 CRSF에 안전할 수 있을 것 같지만 해커의 사이트에서 스크립트 조작이 가능하기에 이 역시 안전하지 않다고 생각한다.
#### 결론
- 여러 자료를 찾아본 결과 cookie를 사용하는 것이 더 좋다라는 것이 내 생각이다. cookie의 경우 HttpOnly, secure, SameSite 설정 등을 통해 어느정도 보안 수준을 향상시킬 수 있기 때문에 더 나은 방법 같다.
